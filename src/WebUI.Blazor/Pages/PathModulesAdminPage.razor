@page "/administration/paths/{key}/modules"

<Breadcrumbs Items="@_breadCrumbs" />
<AuthorizeView Roles="Administrator"
               Context="AuthContext">
    <Authorized>
        <Condition Evaluation="_pathsModules != null">
            <Match>
                <MudButton Style="margin-bottom: 20px" StartIcon="@Icons.Outlined.Add" 
                           OnClick="ShowModalAddModule">@localizer["AddModule"]</MudButton>
                <MudTable Items="@_pathsModules" Filter="Filter">
                    <ToolBarContent>
                        <MudText Typo="Typo.h6">@localizer["PathModules"]</MudText>
                        <MudSpacer/>
                        <MudTextField @bind-Value="_searchString" Placeholder="@localizer["Search"]"
                                      Adornment="Adornment.Start"
                                      AdornmentIcon="@Icons.Material.Filled.Search"
                                      IconSize="Size.Medium"
                                      Class="mt-0"></MudTextField>
                    </ToolBarContent>
                    <HeaderContent>
                        <MudTh>Id</MudTh>
                        <MudTh></MudTh>
                        <MudTh>@localizer["ModuleTitle"]</MudTh>
                        <MudTh>@localizer["UriKey"]</MudTh>
                        <MudTh>@localizer["Necessity"]</MudTh>
                        <MudTh>@localizer["Tags"]</MudTh>
                    </HeaderContent>
                    <RowTemplate>
                        <MudTd DataLabel="Id">@context.Id</MudTd>
                        <MudTd>
                            <MudButton Color="Color.Primary" OnClick="() => context.ShowDetails = !context.ShowDetails">
                                @localizer["Prerequisites"]
                            </MudButton>
                        </MudTd>
                        <MudTd DataLabel="@localizer["ModuleTitle"]">@context.Title</MudTd>
                        <MudTd DataLabel="@localizer["UriKey"]">@context.Key</MudTd>
                        <MudTd DataLabel="@localizer["Necessity"]">@localizer[context.Necessity.ToString()]</MudTd>
                        <MudTd DataLabel="@localizer["Tags"]">
                            <Iterations Items="@context.Tags" Context="tagItem">
                                <MudChip Size="Size.Small">@tagItem</MudChip>
                            </Iterations>
                        </MudTd>
                    </RowTemplate>
                    <ChildRowContent>
                        <Condition Evaluation="context.ShowDetails">
                            <Match>
                                <td colspan="6">
                                    <MudCard Elevation="0">
                                        <MudCardHeader>
                                            <CardHeaderContent>
                                                <MudText Typo="Typo.body1">@localizer["Prerequisites details"]</MudText>
                                            </CardHeaderContent>
                                        </MudCardHeader>
                                        <MudCardContent Class="pa-0">
                                            <MudTable Items="@context.Prerequisites"
                                                      Context="PrerequisitesContext"
                                                      Hover="true"
                                                      Breakpoint="Breakpoint.Sm">
                                                <RowTemplate>
                                                    <MudTd>@PrerequisitesContext.Title</MudTd>
                                                </RowTemplate>
                                            </MudTable>
                                        </MudCardContent>
                                    </MudCard>
                                </td>
                            </Match>
                        </Condition>
                    </ChildRowContent>
                </MudTable>
            </Match>
            <NotMatch>
                <MudProgressLinear Indeterminate="true" Color="Color.Primary"></MudProgressLinear>
            </NotMatch>
        </Condition>
    </Authorized>
    <NotAuthorized>
        @localizer["NotAuthorized"]
    </NotAuthorized>
</AuthorizeView>